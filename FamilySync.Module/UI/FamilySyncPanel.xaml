<UserControl x:Class="FamilySync.Module.UI.FamilySyncPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White"
             FontFamily="Segoe UI">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="SharedStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Field 1: Selected Family -->
        <StackPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock Text="Выбранное семейство:" 
                       FontSize="12" 
                       Foreground="#333333"
                       Margin="0,0,0,4"/>
            <TextBox x:Name="txtSelectedFamily"
                     Text="Семейство_ОВиК_Воздуховод_Прямоугольный"
                     IsReadOnly="True"
                     Background="#F8F8F8"
                     BorderBrush="#ADADAD"
                     BorderThickness="1"
                     Padding="6"
                     FontSize="12"
                     Foreground="#333333"/>
        </StackPanel>
        
        <!-- Field 2: Nested Families (readonly display) -->
        <StackPanel Grid.Row="1" Margin="0,0,0,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="Вложенные семейства:" 
                           FontSize="12" 
                           Foreground="#333333"
                           Margin="0,0,8,4"
                           VerticalAlignment="Top"/>
                <TextBlock x:Name="txtNestedCount"
                           Grid.Column="1"
                           Text="" 
                           FontSize="11"
                           Foreground="#666666"
                           Margin="0,0,0,4"
                           VerticalAlignment="Top"/>
            </Grid>
            
            <!-- TreeView with ScrollViewer for nested families -->
            <Border BorderBrush="#ADADAD"
                    BorderThickness="1"
                    Background="#F8F8F8"
                    MinHeight="100"
                    MaxHeight="200">
                <ScrollViewer VerticalScrollBarVisibility="Auto" 
                              HorizontalScrollBarVisibility="Disabled">
                    <TreeView x:Name="treeNestedFamilies"
                              Background="Transparent"
                              BorderThickness="0"
                              Padding="4"
                              FontSize="11"
                              Foreground="#333333">
                        <TreeView.ItemContainerStyle>
                            <Style TargetType="TreeViewItem">
                                <Setter Property="IsExpanded" Value="True"/>
                                <Setter Property="Margin" Value="0,2,0,2"/>
                            </Style>
                        </TreeView.ItemContainerStyle>
                    </TreeView>
                </ScrollViewer>
            </Border>
            
            <!-- Hidden element for backwards compatibility -->
            <TextBox x:Name="txtNestedFamilies" Visibility="Collapsed"/>
        </StackPanel>
        
        <!-- Fields 3 and 5 in one row -->
        <Grid Grid.Row="2" Margin="0,0,0,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Field 3: Sync Parameter -->
            <StackPanel Grid.Column="0">
                <TextBlock Text="Параметр для синхронизации:" 
                           FontSize="12" 
                           Foreground="#333333"
                           Margin="0,0,0,4"/>
                <ComboBox x:Name="cmbParameter"
                          Height="26"
                          FontSize="12"
                          IsEditable="True"
                          IsTextSearchEnabled="False"
                          BorderBrush="#ADADAD"
                          Background="White"
                          Text="Введите или выберите..."/>
            </StackPanel>
            
            <!-- Field 5: Sync Value -->
            <StackPanel Grid.Column="2">
                <TextBlock Text="Значение для синхронизации:" 
                           FontSize="12" 
                           Foreground="#333333"
                           Margin="0,0,0,4"/>
                <Grid>
                    <TextBox x:Name="txtSyncValue"
                             Height="26"
                             FontSize="12"
                             BorderBrush="#ADADAD"
                             Padding="6,4"
                             TextChanged="TxtSyncValue_TextChanged"/>
                    <TextBlock x:Name="txtSyncValuePlaceholder"
                               Text="Введите значение..."
                               FontSize="12"
                               Foreground="#999999"
                               Padding="7,5,6,4"
                               IsHitTestVisible="False"
                               Visibility="Visible"/>
                </Grid>
            </StackPanel>
        </Grid>
        
        <!-- Checkboxes 4 and 6 below fields -->
        <StackPanel Grid.Row="3" Margin="0,0,0,12">
            <!-- Checkbox 4: Create parameter -->
            <CheckBox x:Name="chkCreateParameter"
                      Content="Создать параметр проекта, если он не существует"
                      FontSize="12"
                      Foreground="#333333"
                      IsChecked="False"
                      Margin="0,0,0,6"/>
            
            <!-- Checkbox 6: Copy from parent -->
            <CheckBox x:Name="chkCopyFromParent"
                      Content="Копировать значение параметра из родительского семейства"
                      FontSize="12"
                      Foreground="#333333"
                      IsChecked="False"
                      Checked="ChkCopyFromParent_CheckedChanged"
                      Unchecked="ChkCopyFromParent_CheckedChanged"/>
        </StackPanel>
        
        <!-- Action Buttons -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="0,0,0,12">
            <Button x:Name="btnAnalyze"
                    Content="Анализировать"
                    Style="{StaticResource SecondaryButton}"
                    Click="BtnAnalyze_Click"
                    Margin="0,0,12,0"/>
            <Button x:Name="btnSynchronize"
                    Content="Синхронизировать"
                    Style="{StaticResource SecondaryButton}"
                    Click="BtnSynchronize_Click"
                    IsEnabled="False"/>
        </StackPanel>
        
        <!-- Status Box -->
        <GroupBox Grid.Row="5"
                  Header="Статус"
                  MinHeight="60"
                  BorderBrush="#D0D0D0"
                  FontSize="12">
            <Grid>
                <TextBlock x:Name="txtProgress" 
                           Padding="8"
                           FontSize="12"
                           Foreground="#333333"
                           TextWrapping="Wrap"
                           Visibility="Collapsed"/>
                <TextBlock x:Name="txtStatus"
                           Padding="8"
                           FontSize="12"
                           Foreground="#495057"
                           TextWrapping="Wrap"
                           Text=""/>
            </Grid>
        </GroupBox>
        
        <!-- Footer Buttons - REMOVED (not needed) -->
    </Grid>
</UserControl>
